<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Green Line Struggle: MBTA's Capacity Crisis</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>
    <!-- Hero Section -->
    <div class="hero-section">
        <h1>The Green Line Struggle: Can the MBTA Sustain Its Riders?</h1>
        <p>The MBTA Green Line is facing significant challenges. From longer wait times to overcrowded platforms, it is becoming increasingly difficult for Boston commuters to rely on the T. Explore the issues through data, stories, and interactive visualizations.</p>
    </div>

    <!-- Interactive Map Section -->
    <div class="map-section">
        <h2>Interactive Green Line Map</h2>
        <p>Hover over each station to see the average wait times between trains for the month of September.</p>
        <div id="map" style="height: 600px; width: 100%; margin: 0 auto;"></div>
    </div>

    <!-- Data Visualization Section -->
    <div class="data-visualization">
        <h2>Green Line Capacity vs. Demand</h2>
        <p>The demand for the Green Line far exceeds its current capacity. Explore how wait times fluctuate and what this means for commuters.</p>
        <div id="capacity-chart"></div>
    </div>

    <!-- Narrative Section -->
    <div class="narrative-section">
        <h2>Voices of the Riders</h2>
        <p>"Sometimes I wait for over 20 minutes just to see an already-packed train roll up to the station," says Sarah, a daily commuter from Allston. The experience of Green Line riders is marked by frustration, long waits, and packed trains. Can the Green Line keep up?</p>
    </div>

    <!-- JavaScript for Map and Visualization -->
    <script>
        // Initialize the Leaflet map
        const map = L.map('map').setView([42.3601, -71.0589], 12); // Center on Boston

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Full dataset of Green Line stations
        const stations = [
            { name: "Boston College", lat: 42.340081, lng: -71.166769, branch: "B", avgWait: 10 },
            { name: "South Street", lat: 42.339394, lng: -71.157995, branch: "B", avgWait: 9 },
            { name: "Chestnut Hill Avenue", lat: 42.338169, lng: -71.152811, branch: "B", avgWait: 8 },
            { name: "Chiswick Road", lat: 42.340805, lng: -71.147598, branch: "B", avgWait: 7 },
            { name: "Sutherland Road", lat: 42.341551, lng: -71.141271, branch: "B", avgWait: 8 },
            { name: "Washington Street", lat: 42.343864, lng: -71.137762, branch: "B", avgWait: 7 },
            { name: "Warren Street", lat: 42.348097, lng: -71.135268, branch: "B", avgWait: 8 },
            { name: "Allston Street", lat: 42.348255, lng: -71.131564, branch: "B", avgWait: 9 },
            { name: "Griggs Street", lat: 42.348545, lng: -71.125915, branch: "B", avgWait: 8 },
            { name: "Harvard Avenue", lat: 42.350651, lng: -71.121204, branch: "B", avgWait: 7 },
            { name: "Packard's Corner", lat: 42.353020, lng: -71.118770, branch: "B", avgWait: 6 },
            { name: "Blandford Street", lat: 42.349293, lng: -71.100258, branch: "B", avgWait: 5 },
            { name: "Kenmore", lat: 42.3483, lng: -71.0956, branch: "C", avgWait: 5 },
            { name: "Hynes Convention Center", lat: 42.34735, lng: -71.08781, branch: "C", avgWait: 6 },
            { name: "Copley", lat: 42.349974, lng: -71.077447, branch: "C", avgWait: 4 },
            { name: "Arlington", lat: 42.351902, lng: -71.070893, branch: "C", avgWait: 4 },
            { name: "Boylston", lat: 42.35302, lng: -71.06459, branch: "C", avgWait: 3 },
            { name: "Park Street", lat: 42.3564, lng: -71.0623, branch: "B", avgWait: 4 },
            { name: "Government Center", lat: 42.359705, lng: -71.059215, branch: "C", avgWait: 5 },
            { name: "Haymarket", lat: 42.363021, lng: -71.05829, branch: "C", avgWait: 6 },
            { name: "North Station", lat: 42.365577, lng: -71.06129, branch: "C", avgWait: 5 },
            { name: "Science Park/West End", lat: 42.366664, lng: -71.067666, branch: "E", avgWait: 7 },
            { name: "Lechmere", lat: 42.3708, lng: -71.076, branch: "E", avgWait: 6 },
            { name: "Heath Street", lat: 42.328979, lng: -71.110223, branch: "E", avgWait: 9 },
            { name: "Back of the Hill", lat: 42.330139, lng: -71.111313, branch: "E", avgWait: 8 },
            { name: "Riverway", lat: 42.331684, lng: -71.111931, branch: "E", avgWait: 8 },
            { name: "Fenwood Road", lat: 42.333706, lng: -71.109733, branch: "E", avgWait: 7 },
            { name: "Mission Park", lat: 42.333179, lng: -71.108631, branch: "E", avgWait: 8 },
            { name: "Longwood Medical Area", lat: 42.335084, lng: -71.107807, branch: "E", avgWait: 7 },
            { name: "Brigham Circle", lat: 42.334229, lng: -71.10553, branch: "E", avgWait: 7 },
            { name: "Fenway", lat: 42.345394, lng: -71.104165, branch: "D", avgWait: 6 },
            { name: "Brookline Village", lat: 42.332927, lng: -71.116608, branch: "D", avgWait: 8 },
            { name: "Brookline Hills", lat: 42.33154, lng: -71.12665, branch: "D", avgWait: 8 },
            { name: "Beaconsfield", lat: 42.335663, lng: -71.141019, branch: "D", avgWait: 9 },
            { name: "Reservoir", lat: 42.336971, lng: -71.148624, branch: "D", avgWait: 10 },
            { name: "Chestnut Hill", lat: 42.326653, lng: -71.165314, branch: "D", avgWait: 9 },
            { name: "Newton Centre", lat: 42.329391, lng: -71.192429, branch: "D", avgWait: 11 },
            { name: "Newton Highlands", lat: 42.321597, lng: -71.206508, branch: "D", avgWait: 12 },
            { name: "Eliot", lat: 42.319023, lng: -71.216483, branch: "D", avgWait: 11 },
            { name: "Waban", lat: 42.325407, lng: -71.230923, branch: "D", avgWait: 10 },
            { name: "Woodland", lat: 42.333378, lng: -71.244274, branch: "D", avgWait: 10 },
            { name: "Riverside", lat: 42.337112, lng: -71.25266, branch: "D", avgWait: 11 }
        ];

        // Colors for each branch
        const branchColors = {
            "B": "#00843D",
            "C": "#0067AC",
            "D": "#ED8B00",
            "E": "#8A8A8D"
        };

        // Add each station as a circle marker on the map
        stations.forEach(station => {
            L.circleMarker([station.lat, station.lng], {
                color: branchColors[station.branch],
                radius: 8,
                fillOpacity: 0.7
            })
            .bindTooltip(`<strong>${station.name}</strong><br>Avg Wait Time: ${station.avgWait} minutes`)
            .addTo(map);
        });

        // Data Visualization using D3.js for capacity vs. demand
        const capacityData = [
            { day: 'Monday', capacity: 70, demand: 120 },
            { day: 'Tuesday', capacity: 70, demand: 110 },
            { day: 'Wednesday', capacity: 70, demand: 130 },
            { day: 'Thursday', capacity: 70, demand: 125 },
            { day: 'Friday', capacity: 70, demand: 150 },
            { day: 'Saturday', capacity: 70, demand: 100 },
            { day: 'Sunday', capacity: 70, demand: 90 }
        ];

        const margin = { top: 20, right: 30, bottom: 40, left: 40 },
              width = 800 - margin.left - margin.right,
              height = 400 - margin.top - margin.bottom;

        const svg = d3.select("#capacity-chart")
                      .append("svg")
                      .attr("width", width + margin.left + margin.right)
                      .attr("height", height + margin.top + margin.bottom)
                      .append("g")
                      .attr("transform", `translate(${margin.left},${margin.top})`);

        const x = d3.scaleBand()
                    .domain(capacityData.map(d => d.day))
                    .range([0, width])
                    .padding(0.2);

        svg.append("g")
           .attr("transform", `translate(0,${height})`)
           .call(d3.axisBottom(x));

        const y = d3.scaleLinear()
                    .domain([0, 160])
                    .nice()
                    .range([height, 0]);

        svg.append("g")
           .call(d3.axisLeft(y));

        svg.selectAll(".bar.capacity")
           .data(capacityData)
           .enter()
           .append("rect")
           .attr("class", "bar capacity")
           .attr("x", d => x(d.day))
           .attr("y", d => y(d.capacity))
           .attr("width", x.bandwidth() / 2)
           .attr("height", d => height - y(d.capacity))
           .attr("fill", "#00843D");

        svg.selectAll(".bar.demand")
           .data(capacityData)
           .enter()
           .append("rect")
           .attr("class", "bar demand")
           .attr("x", d => x(d.day) + x.bandwidth() / 2)
           .attr("y", d => y(d.demand))
           .attr("width", x.bandwidth() / 2)
           .attr("height", d => height - y(d.demand))
           .attr("fill", "#ED8B00");
    </script>
</body>
</html>
